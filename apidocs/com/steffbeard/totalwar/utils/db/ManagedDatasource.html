<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ManagedDatasource (Core 0.0.1-SNAPSHOT API)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ManagedDatasource (Core 0.0.1-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ManagedDatasource.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/steffbeard/totalwar/utils/db/ConnectionPool.html" title="class in com.steffbeard.totalwar.utils.db"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/steffbeard/totalwar/utils/db/NameAPI.html" title="class in com.steffbeard.totalwar.utils.db"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/steffbeard/totalwar/utils/db/ManagedDatasource.html" target="_top">Frames</a></li>
<li><a href="ManagedDatasource.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.steffbeard.totalwar.utils.db</div>
<h2 title="Class ManagedDatasource" class="title">Class ManagedDatasource</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.steffbeard.totalwar.utils.db.ManagedDatasource</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>org.bukkit.configuration.serialization.ConfigurationSerializable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">ManagedDatasource</span>
extends <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>
implements org.bukkit.configuration.serialization.ConfigurationSerializable</pre>
<div class="block">Plugins should replace their custom Database handlers with an instance of ManagedDatasource.
 
 See the <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#ManagedDatasource-com.steffbeard.totalwar.Core-java.lang.String-java.lang.String-java.lang.String-int-java.lang.String-int-long-long-long-"><code>ManagedDatasource(com.steffbeard.totalwar.Core, java.lang.String, java.lang.String, java.lang.String, int, java.lang.String, int, long, long, long)</code></a> constructor for details on how to use the ManagedDatasource.
 
 To convert existing plugins, do the following:

   1. Take existing database version code and refactor it.
      a. Any CREATE, UPDATE, ALTER, or similar statements, convert to a List of Strings and pass
         them into ManagedDatasource as a Migration using <code>#registerMigration(Integer, boolean, String...)</code>
      b. Find your prepared statements. Convert the string resources as static final in your plugin's DAO layer.
      c. Remove any "is database alive" check code. It's not needed.
      d. Remove any version management code that remains
      e. DO react to the results of the <code>#upgradeDatabase</code> call. 
         i.   If false is returned, terminate your plugin.
         ii.  If false is returned and your plugin is critical to a host of other plugins, terminate the server.
         iii. If an Exception is thrown, I strongly recommend you consider it a "false" return value and react accordingly.
      f. Note: Create a "first" migration at index -1 that ignores errors and copies any "current" migration state data
         from the db_version or equivalent table into the <code>managed_plugin_data</code> table. 
  2. Throughout your plugin, ensure that PreparedStatements are "created" new each request and against a 
     newly retrieved Connection (using <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#getConnection--"><code>getConnection()</code></a> of this class). Don't worry about PrepareStatements.
     The driver will manage caching them efficiently.
  3. Make sure you release Connections using <a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html?is-external=true#close--" title="class or interface in java.sql"><code>Connection.close()</code></a> as soon as you can (when done with them). 
     a. Don't hold on to Connections. 
     b. Close them. 
     c. Use "try-with-resources" where-ever possible so that they are auto-closed.
  4. If you have loops to insert a bunch of similar records, convert it to a batch. Find instructions in <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#ManagedDatasource-com.steffbeard.totalwar.Core-java.lang.String-java.lang.String-java.lang.String-int-java.lang.String-int-long-long-long-"><code>ManagedDatasource(com.steffbeard.totalwar.Core, java.lang.String, java.lang.String, java.lang.String, int, java.lang.String, int, long, long, long)</code></a>.
  5. If you have special needs like atomic multi-statement, do all your work on a single Connection and return it to 
     a clean state when you are done. (turn auto-commit back on, ensure all transactions are committed, etc.)

 That should cover most cases. Note that points 2 & 3 are critical. Point 1 is required. Point 4 and 5 are highly recommended.
 
 TODO: Make this instantiable via ConfigurationSerializable interface.</div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>ProgrammerDan</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#ManagedDatasource-com.steffbeard.totalwar.Core-java.lang.String-java.lang.String-java.lang.String-int-java.lang.String-int-long-long-long-">ManagedDatasource</a></span>(<a href="../../../../../com/steffbeard/totalwar/Core.html" title="class in com.steffbeard.totalwar">Core</a>&nbsp;plugin,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;user,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;pass,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;host,
                 int&nbsp;port,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;database,
                 int&nbsp;poolSize,
                 long&nbsp;connectionTimeout,
                 long&nbsp;idleTimeout,
                 long&nbsp;maxLifetime)</code>
<div class="block">Create a new ManagedDatasource.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#close--">close</a></span>()</code>
<div class="block">Passthrough; closes the underlying pool.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html" title="class in com.steffbeard.totalwar.utils.db">ManagedDatasource</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#deserialize-java.util.Map-">deserialize</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&gt;&nbsp;data)</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#getConnection--">getConnection</a></span>()</code>
<div class="block">Passthrough; gets a connection from the underlying ConnectionPool.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#isManaged--">isManaged</a></span>()</code>
<div class="block">Checks if this plugin is already managed by the ManagedDatasource infrastructure or not.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#registerMigration-int-boolean-java.util.concurrent.Callable-java.lang.String...-">registerMigration</a></span>(int&nbsp;migration,
                 boolean&nbsp;ignoreErrors,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html?is-external=true" title="class or interface in java.util.concurrent">Callable</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html?is-external=true" title="class or interface in java.lang">Boolean</a>&gt;&nbsp;postCall,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>...&nbsp;query)</code>
<div class="block">Core's should call this to register their migration code.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#registerMigration-int-boolean-java.lang.String...-">registerMigration</a></span>(int&nbsp;migration,
                 boolean&nbsp;ignoreErrors,
                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>...&nbsp;query)</code>&nbsp;</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#serialize--">serialize</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#updateDatabase--">updateDatabase</a></span>()</code>
<div class="block">This method should be called by your plugin after all migrations have been registered.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ManagedDatasource-com.steffbeard.totalwar.Core-java.lang.String-java.lang.String-java.lang.String-int-java.lang.String-int-long-long-long-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ManagedDatasource</h4>
<pre>public&nbsp;ManagedDatasource(<a href="../../../../../com/steffbeard/totalwar/Core.html" title="class in com.steffbeard.totalwar">Core</a>&nbsp;plugin,
                         <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;user,
                         <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;pass,
                         <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;host,
                         int&nbsp;port,
                         <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;database,
                         int&nbsp;poolSize,
                         long&nbsp;connectionTimeout,
                         long&nbsp;idleTimeout,
                         long&nbsp;maxLifetime)</pre>
<div class="block">Create a new ManagedDatasource.
 
 After creating, a plugin should register its migrations, which are just numbered "sets" of queries to run.
 
 Use <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#registerMigration-int-boolean-java.util.concurrent.Callable-java.lang.String...-"><code>registerMigration(int, boolean, Callable, String...)</code></a> to add a new migration.
 
 When you are done adding, call <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#updateDatabase--"><code>updateDatabase()</code></a> which gets a lock on migrating for this
   plugin, then checks if any migrations need to be applied, and applies as needed.
   
 Now, your database connection pool will be ready to use! 
 
 Don't worry about "pre-preparing" statements. Just use the following pattern:
 
 <code>
   try (Connection connection = myManagedDatasource.getConnection();
                PreparedStatement statement = connection.prepareStatement("SELECT * FROM sample;");) {
        // code that uses `statement`
   } catch (SQLException se) {
        // code that alerts on failure
   }
 </code>
 
 Or similar w/ normal Statements. This is a try-with-resources block, and it ensures that once
   the query is complete (even if it errors!) all resources are "closed". In the case of the 
   connection pool, this just returns the connection back to the connection pool for use
   elsewhere.
   
 If you want to batch, just use a PreparedStatement as illustrated above, and use 
   <code>.addBatch();</code> on it after adding each set of parameters. When you are done,
   call <code>.executeBatch();</code> and all the statements will be executed in order.
   Be sure to watch for errors or warnings and of course read the PreparedStatement API docs
   for any further questions.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>plugin</code> - The Core that this datasource backs</dd>
<dd><code>user</code> - The SQL user to connect with</dd>
<dd><code>pass</code> - The password to connect with</dd>
<dd><code>host</code> - The host name / IP of the database server</dd>
<dd><code>port</code> - The port to connection to</dd>
<dd><code>database</code> - The name of the database file</dd>
<dd><code>poolSize</code> - The max # of concurrent connections available in the pool</dd>
<dd><code>connectionTimeout</code> - The length of time to wait for an active query to return</dd>
<dd><code>idleTimeout</code> - The length of time a connection can wait unused before being recycled</dd>
<dd><code>maxLifetime</code> - The absolute length of time a connection is allowed to live in the pool.</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="registerMigration-int-boolean-java.lang.String...-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerMigration</h4>
<pre>public&nbsp;void&nbsp;registerMigration(int&nbsp;migration,
                              boolean&nbsp;ignoreErrors,
                              <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>...&nbsp;query)</pre>
</li>
</ul>
<a name="registerMigration-int-boolean-java.util.concurrent.Callable-java.lang.String...-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerMigration</h4>
<pre>public&nbsp;void&nbsp;registerMigration(int&nbsp;migration,
                              boolean&nbsp;ignoreErrors,
                              <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html?is-external=true" title="class or interface in java.util.concurrent">Callable</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html?is-external=true" title="class or interface in java.lang">Boolean</a>&gt;&nbsp;postCall,
                              <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>...&nbsp;query)</pre>
<div class="block">Core's should call this to register their migration code. After migrations are registered,
 host plugins can call the <a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html#updateDatabase--"><code>updateDatabase()</code></a> method to trigger each migration in turn.
 
 This is _not_ checked for completeness or accuracy.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>migration</code> - The migration ID -- 0, 1, 2 etc.</dd>
<dd><code>ignoreErrors</code> - indicates if errors in this migration should be ignored.</dd>
<dd><code>postCall</code> - A "Callable" to run after the migration SQL is run, but before the next migration begins.
        Optional. Leave null to do nothing.</dd>
<dd><code>query</code> - The queries to run, in sequence</dd>
</dl>
</li>
</ul>
<a name="updateDatabase--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateDatabase</h4>
<pre>public&nbsp;boolean&nbsp;updateDatabase()</pre>
<div class="block">This method should be called by your plugin after all migrations have been registered.
   It applies the migrations if necessary in a "multi-tenant" safe way via a soft-lock.
   Locks have a maximum duration currently set to 8 hours, but realistically they will
   be very short. For multi-tenant updates all servers should gracefully wait in line.

 1. Attempts to get a lock for migrations for this plugin.
 2. If unsuccessful, periodically check the lock for release.
    a. Once released, restart at 1.
    b. If Timeout occurs, return "false".
 3. If successful, check for current update level.
    a. If no record exists, start with first migration, and apply
       in sequence from first to last, updating the migration management
       table along the way
    b. If a record exists, read which migration was completed last
       i.   If identical to "highest" registered migration level, do nothing.
       ii.  If less then "highest" registered migration level,
            get the tailset of migrations "after" the last completed level, and run.
 4. If no errors occurred, or this migration has errors marked ignored, return true.
 5. If errors, return false.
 6. In either case, release the lock.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>As described in the algorithm above, returns true if no errors or all ignored; 
    or false if unable to start migration in a timely fashion or errors occurred.</dd>
</dl>
</li>
</ul>
<a name="isManaged--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isManaged</h4>
<pre>public&nbsp;boolean&nbsp;isManaged()</pre>
<div class="block">Checks if this plugin is already managed by the ManagedDatasource infrastructure or not.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Returns true if the plugin has an entry in the migrations table; false for any other
   outcome.</dd>
</dl>
</li>
</ul>
<a name="getConnection--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getConnection</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a>&nbsp;getConnection()
                         throws <a href="http://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html?is-external=true" title="class or interface in java.sql">SQLException</a></pre>
<div class="block">Passthrough; gets a connection from the underlying ConnectionPool.
 Simply close() it when done.
 
 This method _could_ briefly block while waiting for a connection. Keep this in mind.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A <a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql"><code>Connection</code></a> connection from the pool.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html?is-external=true" title="class or interface in java.sql">SQLException</a></code> - If the pool has gone away, database is not connected, or other
   error in retrieving a connection.</dd>
</dl>
</li>
</ul>
<a name="close--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()
           throws <a href="http://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html?is-external=true" title="class or interface in java.sql">SQLException</a></pre>
<div class="block">Passthrough; closes the underlying pool. Cannot be undone.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html?is-external=true" title="class or interface in java.sql">SQLException</a></code> - something went horribly wrong.</dd>
</dl>
</li>
</ul>
<a name="serialize--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>serialize</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&gt;&nbsp;serialize()</pre>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>serialize</code>&nbsp;in interface&nbsp;<code>org.bukkit.configuration.serialization.ConfigurationSerializable</code></dd>
</dl>
</li>
</ul>
<a name="deserialize-java.util.Map-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>deserialize</h4>
<pre>public&nbsp;<a href="../../../../../com/steffbeard/totalwar/utils/db/ManagedDatasource.html" title="class in com.steffbeard.totalwar.utils.db">ManagedDatasource</a>&nbsp;deserialize(<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&gt;&nbsp;data)</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ManagedDatasource.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/steffbeard/totalwar/utils/db/ConnectionPool.html" title="class in com.steffbeard.totalwar.utils.db"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/steffbeard/totalwar/utils/db/NameAPI.html" title="class in com.steffbeard.totalwar.utils.db"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/steffbeard/totalwar/utils/db/ManagedDatasource.html" target="_top">Frames</a></li>
<li><a href="ManagedDatasource.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2020. All rights reserved.</small></p>
</body>
</html>
